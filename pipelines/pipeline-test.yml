trigger:
  branches:
    include:
      - test
  paths:
    include:
      - infrastructure/
    exclude:
      - infrastructure/azure-pipelines.yml

pool:
  vmImage: 'ubuntu-latest'

variables:
  - group: service_principals
  - name: stage
    value: test

stages:
  - stage: plan
    jobs:
      - job: plan
        steps:
          - template: templates/plan.yml
            parameters:
              stage: $(stage)

  - stage: apply
    jobs:
      - job: apply
        steps:
          - template: templates/apply.yml
            parameters:
              stage: $(stage)
